/* 0.1.1 обновление прошивки касс

cscript firmware.min.js <image>

<image>		- путь к файлу с прошивкой.

*/

(function(m,h){var c,k;h=!1;var b=0;var n=new ActiveXObject("Scripting.FileSystemObject");!b&&0<m.arguments.length&&(c=m.arguments(0))&&(k=n.getAbsolutePathName(c));b||!k||n.fileExists(k)||(b=1);if(!b)try{var a=new ActiveXObject("Addin.DrvFR")}catch(r){b=2}if(!b){var p=a.BaudRate;a.Password=30;a.GetECRStatus();a.ResultCode?b=3:(c=a.ECRMode,4!=c&&(b=3))}if(!b){var l={};for(var d=1;!a.ResultCode;d++){a.TableNumber=d;a.GetTableStruct();l[d]={};var e=1;for(n=a.RowNumber;!a.ResultCode&&e<=n;e++){l[d][e]=
{};for(var f=1,q=a.FieldNumber;!a.ResultCode&&f<=q;f++)a.TableNumber=d,a.RowNumber=e,a.FieldNumber=f,a.GetFieldStruct(),a.ResultCode||(a.ReadTable(),a.ResultCode||a.FieldType&&1==a.MAXValueOfField||(c=a.FieldType?a.ValueOfFieldString:a.ValueOfFieldInteger,17==d&&1==e&&3==f&&(c=2),17==d&&1==e&&10==f&&(c=1),17==d&&1==e&&11==f&&(c=7),17==d&&1==e&&12==f&&(c=7),17==d&&1==e&&17==f&&(c=2),17==d&&1==e&&39==f&&(c=1),23==d&&1==e&&1==f&&(c=1),23==d&&1==e&&5==f&&(c=1),23==d&&1==e&&6==f&&(c=1),l[d][e][f]=c))}}93!=
a.ResultCode&&(b=4)}if(!b&&!h)if(a.UpdateFirmwareMethod=1,a.FileName=k,a.UpdateFirmware(),a.ResultCode)b=5;else{for(;1==a.UpdateFirmwareStatus;)m.sleep(15E3);a.UpdateFirmwareStatus||(h=!0)}if(!b&&!h)if(a.UpdateFirmwareMethod=0,a.FileName=k,a.UpdateFirmware(),a.ResultCode)b=6;else{for(;1==a.UpdateFirmwareStatus;)m.sleep(15E3);a.UpdateFirmwareStatus||(h=!0)}b||h||(a.TableNumber=14,a.RowNumber=1,a.FieldNumber=1,a.GetFieldStruct(),a.ResultCode?b=7:(a.ReadTable(),a.ResultCode?b=7:(c=a.FieldType?a.ValueOfFieldString:
a.ValueOfFieldInteger,0!=c&&(b=7))));b||h||(c=0,a.TableNumber=23,a.RowNumber=1,a.FieldNumber=1,a.GetFieldStruct(),a.ResultCode?b=8:(a.FieldType?a.ValueOfFieldString=c:a.ValueOfFieldInteger=c,a.WriteTable(),a.ResultCode&&(b=8)));b||h||(a.FileType=1,a.FileName=k,a.LoadFileOnSDCard(),a.ResultCode&&(b=9));b||h||(a.RebootKKT(),a.ResultCode&&(b=10));if(!b){a.Password=30;a.ConnectionTimeout=15E3;a.WaitConnection();d=0;for(k=5;a.ResultCode&&d<k;d++)a.WaitConnection(),m.sleep(15E3);d=0;for(k=7;a.ResultCode&&
d<k;d++)a.BaudRate=d,a.WaitConnection();a.ResultCode&&(b=11)}b||h||(a.GetECRStatus(),a.ResultCode?b=12:(c=a.ECRMode,9!=c&&(b=12)));b||h||(a.ResetSettings(),a.ResultCode&&(b=13));if(!b){var g=new Date;c=[9<g.getHours()?g.getHours():"0"+g.getHours(),9<g.getMinutes()?g.getMinutes():"0"+g.getMinutes(),9<g.getSeconds()?g.getSeconds():"0"+g.getSeconds()].join(":");a.Time=c;a.SetTime();a.ResultCode&&(b=14)}b||(c=[9<g.getDate()?g.getDate():"0"+g.getDate(),8<g.getMonth()?g.getMonth()+1:"0"+(g.getMonth()+1),
g.getFullYear()].join("."),a.Date=c,a.SetDate(),a.ResultCode?b=15:(a.ConfirmDate(),a.ResultCode&&(b=15)));b||h||(a.InitTable(),a.ResultCode&&(b=16));if(!b)for(d in l)for(e in l[d])for(f in l[d][e])c=l[d][e][f],a.TableNumber=d,a.RowNumber=e,a.FieldNumber=f,a.GetFieldStruct(),a.ResultCode||(a.FieldType?a.ValueOfFieldString=c:a.ValueOfFieldInteger=c,a.WriteTable());b||(a.GetExchangeParam(),a.ResultCode?b=17:(c=a.BaudRate,c!=p&&(a.BaudRate=p,a.SetExchangeParam(),a.ResultCode&&(b=17))));b||(a.RebootKKT(),
a.ResultCode&&(b=18));m.quit(b)})(WSH);

/* 0.1.0 обновление прошивки касс

cscript firmware.min.js <image>

<image>		- путь к файлу с прошивкой.

*/

(function(l,b){var c,h;b=0;var m=new ActiveXObject("Scripting.FileSystemObject");!b&&0<l.arguments.length&&(c=l.arguments(0))&&(h=m.getAbsolutePathName(c));b||!h||m.fileExists(h)||(b=1);if(!b)try{var a=new ActiveXObject("Addin.DrvFR")}catch(q){b=2}if(!b){var n=a.BaudRate;a.Password=30;a.GetECRStatus();a.ResultCode?b=3:(c=a.ECRMode,4!=c&&(b=3))}b||(a.TableNumber=14,a.RowNumber=1,a.FieldNumber=1,a.GetFieldStruct(),a.ResultCode?b=4:(a.ReadTable(),a.ResultCode?b=4:(c=a.FieldType?a.ValueOfFieldString:
a.ValueOfFieldInteger,0!=c&&(b=4))));if(!b){var k={};for(var d=1;!a.ResultCode;d++){a.TableNumber=d;a.GetTableStruct();k[d]={};var e=1;for(m=a.RowNumber;!a.ResultCode&&e<=m;e++){k[d][e]={};for(var f=1,p=a.FieldNumber;!a.ResultCode&&f<=p;f++)a.TableNumber=d,a.RowNumber=e,a.FieldNumber=f,a.GetFieldStruct(),a.ResultCode||(a.ReadTable(),a.ResultCode||a.FieldType&&1==a.MAXValueOfField||(c=a.FieldType?a.ValueOfFieldString:a.ValueOfFieldInteger,17==d&&1==e&&3==f&&(c=2),17==d&&1==e&&10==f&&(c=1),17==d&&1==
e&&11==f&&(c=7),17==d&&1==e&&12==f&&(c=7),17==d&&1==e&&17==f&&(c=2),17==d&&1==e&&39==f&&(c=1),23==d&&1==e&&1==f&&(c=1),23==d&&1==e&&5==f&&(c=1),23==d&&1==e&&6==f&&(c=1),k[d][e][f]=c))}}93!=a.ResultCode&&(b=5)}b||(c=0,a.TableNumber=23,a.RowNumber=1,a.FieldNumber=1,a.GetFieldStruct(),a.ResultCode?b=6:(a.FieldType?a.ValueOfFieldString=c:a.ValueOfFieldInteger=c,a.WriteTable(),a.ResultCode&&(b=6)));b||(a.FileType=1,a.FileName=h,a.LoadFileOnSDCard(),a.ResultCode&&(b=7));b||(a.RebootKKT(),a.ResultCode&&
(b=8));if(!b){a.Password=30;a.ConnectionTimeout=15E3;a.WaitConnection();d=0;for(h=5;a.ResultCode&&d<h;d++)a.WaitConnection(),l.sleep(15E3);d=0;for(h=7;a.ResultCode&&d<h;d++)a.BaudRate=d,a.WaitConnection();a.ResultCode&&(b=9)}b||(a.GetECRStatus(),a.ResultCode?b=10:(c=a.ECRMode,9!=c&&(b=10)));b||(a.ResetSettings(),a.ResultCode&&(b=11));if(!b){var g=new Date;c=[9<g.getHours()?g.getHours():"0"+g.getHours(),9<g.getMinutes()?g.getMinutes():"0"+g.getMinutes(),9<g.getSeconds()?g.getSeconds():"0"+g.getSeconds()].join(":");
a.Time=c;a.SetTime();a.ResultCode&&(b=12)}b||(c=[9<g.getDate()?g.getDate():"0"+g.getDate(),8<g.getMonth()?g.getMonth()+1:"0"+(g.getMonth()+1),g.getFullYear()].join("."),a.Date=c,a.SetDate(),a.ResultCode?b=13:(a.ConfirmDate(),a.ResultCode&&(b=13)));b||(a.InitTable(),a.ResultCode&&(b=14));if(!b)for(d in k)for(e in k[d])for(f in k[d][e])c=k[d][e][f],a.TableNumber=d,a.RowNumber=e,a.FieldNumber=f,a.GetFieldStruct(),a.ResultCode||(a.FieldType?a.ValueOfFieldString=c:a.ValueOfFieldInteger=c,a.WriteTable());
b||(a.GetExchangeParam(),a.ResultCode?b=15:(c=a.BaudRate,c!=n&&(a.BaudRate=n,a.SetExchangeParam(),a.ResultCode&&(b=15))));b||(a.RebootKKT(),a.ResultCode&&(b=16));l.quit(b)})(WSH);
